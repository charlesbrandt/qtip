define(["jquery","ko","moment"],function(n,a){function e(e,o,t){var r=this,i=(o(),t()),l=i.bind_to||document,d=i.call_on,s=[],g=n("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');s=s.push(g);var c;r.dragging=null;var v=n(r).data("selected");v||(v=[]),n(l).on("dragstart",d,function(a){console.log("dragstart!!"),console.log(this),r.dt=a.originalEvent.dataTransfer,r.dt.effectAllowed="move",r.dt.setData("text/html",this.innerHTML),n(this).addClass("sortable-dragging"),r.dragging=this,c=n(this).index(),console.log(c)}),n(l).on("dragover dragenter",d,function(n){return n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="move",!1}),n(l).on("drop",d,function(e){console.log(n(this).index(),n(r.dragging).index());var o=a.dataFor(r.dragging),t=a.dataFor(this);if(o&&t){var i=o.parent,l=t.parent,d=n(this).index();if(console.log(i.available()),l.available()){i.remove(o),l.insert(o,d);var s="",g='"'+o.content()+'",'+i.name()+","+l.name()+","+s;l.post(g)}else alert("Sorry! That column is full.")}return e.stopPropagation(),!1}),n(l).on("click",d,function(a){a.ctrlKey?(v.push(a.target),n(r).data("selected",v),console.log(v)):a.shiftKey})}function o(e,o,t){var r=this,i=t();r.value=o();var l=i.bind_to||document,d=i.call_on;n(l).on("dragover dragenter",d,function(n){return n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="move",!1}),n(l).on("drop",d,function(e){console.log("droppable drop!!"),console.log(r.dragging),console.log(n(this).index(),n(r.dragging).index());var o=a.dataFor(r.dragging);console.log(o.name());var t=a.dataFor(this);if(console.log(t.name()),o&&t){var i=o.parent,l=n(this).index();if(t.available()){i.remove(o),t.insert(o,l);var d="",s='"'+o.content()+'",'+i.name()+","+t.name()+","+d;t.post(s)}else alert("Sorry! That column is full.")}return e.stopPropagation(),!1})}function t(e,o,t){var r=this,i=t();r.value=o();var l=i.bind_to||document,d=i.call_on;n(l).on("dragover dragenter",d,function(n){return n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="move",!1}),n(l).on("drop",d,function(e){console.log("stackable drop!!"),console.log(r.dragging),console.log(n(this).index(),n(r.dragging).index());var o=a.dataFor(r.dragging);console.log(o.name());var t=a.dataFor(this);if(console.log(t.available.name()),o&&t){var i=o.parent,l=n(this).index();i.remove(o),t.available.insert(o,l);var d="",s='"'+o.content()+'",'+i.name()+","+t.available.name()+","+d;t.available.post(s)}return e.stopPropagation(),!1})}a.bindingHandlers.sortable={init:function(n,a,o){e(n,a,o)},update:function(){}},a.bindingHandlers.dropable={init:function(n,a,e){o(n,a,e)},update:function(){}},a.bindingHandlers.stackable={init:function(n,a,e){t(n,a,e)},update:function(){}}});